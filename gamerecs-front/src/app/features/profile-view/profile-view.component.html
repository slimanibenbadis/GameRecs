<!-- Loading State -->
<p-progressSpinner *ngIf="isLoading" class="w-full flex justify-center py-10" strokeWidth="4" [style]="{width: '50px', height: '50px'}"></p-progressSpinner>

<!-- Error Message -->
<p-message *ngIf="error" severity="error" [text]="error" styleClass="w-full mb-4"></p-message>

<!-- Profile Container -->
<div *ngIf="!isLoading && profile" class="container mx-auto p-4 font-rubik">
  <div class="bg-[#f2fdfb] dark:bg-[#020d0b] rounded-lg shadow-lg p-6 max-w-2xl mx-auto">
    
    <!-- Profile Header -->
    <div class="flex flex-col items-center mb-8">
      <div class="relative mb-4">
        <img [src]="profile.profilePictureUrl || 'assets/images/default-avatar.png'"
             [alt]="profile.username + '\'s profile picture'"
             class="w-32 h-32 rounded-full object-cover border-4 border-[#158475] dark:border-[#7beadb]"
             (error)="handleImageError($event)">
        <button pButton 
                *ngIf="isOwnProfile"
                icon="pi pi-camera" 
                class="p-button-rounded p-button-text absolute bottom-0 right-0"
                (click)="onUpdateProfilePicture()">
        </button>
      </div>
      
      <h1 class="text-3xl font-fira-sans font-bold text-[#062823] dark:text-[#d7f9f4] mb-2">
        {{profile.username}}
      </h1>
      
      <p class="text-[#155b89] dark:text-[#76bbea]">
        {{profile.email}}
      </p>
    </div>

    <!-- Bio Section -->
    <div class="mb-8">
      <h2 class="text-xl font-fira-sans font-semibold text-[#062823] dark:text-[#d7f9f4] mb-3">
        Bio
      </h2>
      <div class="relative">
        <p *ngIf="!isEditing" class="text-[#062823] dark:text-[#d7f9f4] whitespace-pre-wrap">
          {{profile.bio || 'No bio added yet.'}}
        </p>
        <textarea *ngIf="isEditing" 
                  pInputTextarea 
                  [(ngModel)]="editedBio" 
                  class="w-full p-3"
                  rows="4">
        </textarea>
        <div *ngIf="isOwnProfile" class="mt-3">
          <button *ngIf="!isEditing" 
                  pButton 
                  label="Edit Bio" 
                  icon="pi pi-pencil"
                  class="p-button-text"
                  (click)="startEditing()">
          </button>
          <div *ngIf="isEditing" class="flex gap-2">
            <button pButton 
                    label="Save" 
                    icon="pi pi-check"
                    (click)="saveBio()">
            </button>
            <button pButton 
                    label="Cancel" 
                    icon="pi pi-times"
                    class="p-button-secondary"
                    (click)="cancelEditing()">
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Section -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
      <div class="bg-white dark:bg-[#062823] rounded-lg p-4 text-center">
        <h3 class="text-lg font-fira-sans font-semibold text-[#158475] dark:text-[#7beadb]">
          Games Rated
        </h3>
        <p class="text-2xl font-bold text-[#062823] dark:text-[#d7f9f4]">
          {{profile.gamesRated || 0}}
        </p>
      </div>
      <div class="bg-white dark:bg-[#062823] rounded-lg p-4 text-center">
        <h3 class="text-lg font-fira-sans font-semibold text-[#158475] dark:text-[#7beadb]">
          Games in Library
        </h3>
        <p class="text-2xl font-bold text-[#062823] dark:text-[#d7f9f4]">
          {{profile.gamesInLibrary || 0}}
        </p>
      </div>
      <div class="bg-white dark:bg-[#062823] rounded-lg p-4 text-center">
        <h3 class="text-lg font-fira-sans font-semibold text-[#158475] dark:text-[#7beadb]">
          Member Since
        </h3>
        <p class="text-2xl font-bold text-[#062823] dark:text-[#d7f9f4]">
          {{profile.joinDate | date:'mediumDate'}}
        </p>
      </div>
    </div>
  </div>
</div>
